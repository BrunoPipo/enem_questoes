<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Questões ENEM Matemática</title>
  <link rel="icon" href="favicon.png" type="image/png">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
    }

    h1, h3 {
      text-align: center;
    }

    #pesquisa, #colunas {
      width: 240px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      display: block;
      margin: 10px auto;
    }

    .secao-filtros {
      margin: 20px;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .filtro {
      background: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
    }

    #container {
      --cols: 3;
      display: grid;
      grid-template-columns: repeat(var(--cols), 1fr);
      gap: 20px;
      padding: 20px;
    }

    .questao {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .questao img {
      max-width: 100%;
      border-radius: 8px;
      margin: 10px 0;
    }

    .alternativas {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .alternativas button {
      flex: 1 1 30%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #f0f0f0;
    }

    .alternativas button.correta {
      background: #2e7d32;
      color: #fff;
      border-color: #2e7d32;
    }

    .alternativas button.errada {
      background: #c62828;
      color: #fff;
      border-color: #c62828;
    }

    .alternativas button:disabled {
      cursor: default;
      opacity: 0.9;
    }
  </style>
</head>
<body>

<h1>Questões de Matemática – ENEM</h1>

<input type="text" id="pesquisa" placeholder="Pesquisar: ex 2018 45">

<select id="colunas">
  <option value="1">1 coluna</option>
  <option value="2">2 colunas</option>
  <option value="3" selected>3 colunas</option>
  <option value="4">4 colunas</option>
</select>

<div class="secao-filtros">
  <h3>Filtrar por conteúdo</h3>
  <div id="filtrosConteudo" class="filtros"></div>
</div>

<div class="secao-filtros">
  <h3>Filtrar por ano</h3>
  <div id="filtrosAno" class="filtros"></div>
</div>

<hr>

<div id="container"></div>

<script>
let questoes = [];
let termoPesquisa = "";

document.getElementById("colunas").addEventListener("change", e => {
  document.getElementById("container")
    .style.setProperty("--cols", e.target.value);
});

function categoriaPrincipal(texto) {
  texto = texto.toLowerCase();

  if (texto.includes("estatística")) return "Estatística";
  if (texto.includes("função afim")) return "Função Afim";
  if (texto.includes("quadrática")) return "Função Quadrática";
  if (texto.includes("trigonometr")) return "Trigonometria";
  if (texto.includes("analítica")) return "Geometria Analítica";
  if (texto.includes("espacial")) return "Geometria Espacial";
  if (texto.includes("probabilidade")) return "Probabilidade";

  return "Outros";
}

fetch("questoes.csv")
  .then(r => r.text())
  .then(csv => {
    const linhas = csv.trim().split("\n").slice(1);
    const filtrosConteudo = document.getElementById("filtrosConteudo");
    const filtrosAno = document.getElementById("filtrosAno");
    const container = document.getElementById("container");

    const categorias = new Set();
    const anos = new Set();

    linhas.forEach(linha => {
      const [ano, num, conteudos, gabarito] = linha.split(";");
      if (!ano || !num) return;

      const categoria = categoriaPrincipal(conteudos);
      questoes.push({ ano, num, conteudos, gabarito: gabarito.trim(), categoria });

      categorias.add(categoria);
      anos.add(ano);
    });

    [...categorias].sort().forEach(c => filtrosConteudo.appendChild(criarCheckbox(c)));
    [...anos].sort((a,b) => b - a).forEach(a => filtrosAno.appendChild(criarCheckbox(a)));

    document.getElementById("pesquisa").addEventListener("input", e => {
      termoPesquisa = e.target.value.toLowerCase();
      aplicarFiltros();
    });

    renderizar(questoes);

    function criarCheckbox(valor) {
      const label = document.createElement("label");
      label.className = "filtro";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.value = valor;
      cb.addEventListener("change", aplicarFiltros);
      label.appendChild(cb);
      label.appendChild(document.createTextNode(" " + valor));
      return label;
    }

    function aplicarFiltros() {
      const cSel = [...document.querySelectorAll("#filtrosConteudo input:checked")].map(x => x.value);
      const aSel = [...document.querySelectorAll("#filtrosAno input:checked")].map(x => x.value);

      renderizar(
        questoes.filter(q =>
          (cSel.length === 0 || cSel.includes(q.categoria)) &&
          (aSel.length === 0 || aSel.includes(q.ano)) &&
          (termoPesquisa === "" || (`${q.ano} ${q.num}`).toLowerCase().includes(termoPesquisa))
        )
      );
    }

    function renderizar(lista) {
      container.innerHTML = "";

      lista.forEach(q => {
        const div = document.createElement("div");
        div.className = "questao";

        div.innerHTML = `
          <h3>${q.ano} – Questão ${q.num}</h3>

          <img src="imagens/${q.ano}_q${q.num}.png"
               onerror="this.onerror=null;this.src='imagens/${q.ano}_q${q.num}.PNG';">

          <p><strong>Categoria:</strong> ${q.categoria}</p>

          <div class="alternativas" id="alt_${q.ano}_${q.num}">
            ${["A","B","C","D","E"].map(l =>
              `<button onclick="responder('${q.ano}_${q.num}','${l}','${q.gabarito}')">${l}</button>`
            ).join("")}
          </div>
        `;

        container.appendChild(div);
      });
    }
  });

function responder(id, escolha, correta) {
  const botoes = document.querySelectorAll(`#alt_${id} button`);
  botoes.forEach(b => {
    b.disabled = true;
    if (b.textContent === correta) b.classList.add("correta");
  });

  const clicado = [...botoes].find(b => b.textContent === escolha);
  if (escolha !== correta) clicado.classList.add("errada");
}
</script>

</body>
</html>
